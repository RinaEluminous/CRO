var arrApprovedProductCode = ["236614006709257", "SR1026-83-16", "SR1025-83-15", "SR1024-83-14", "SR1023-83-13", "SR1022-83-12", "SR1020-83-10", "SCA16CSR2968", "SCA145WJ2982SR", "SCA145AR2971SR", "SCA16AR3017", "SCA145TRREL2988", "SCA145TRREL2989", "SCA145TR2986", "SCA15AR2975SR", "SCA15AR2973SR", "SCA15WJ2983POIN", "C145JLTRCHOCHFL", "SCA155AR2974", "C145SMARTH78BLK", "U145NRSCTRCHO", "C145FX312CB0656", "GRASSH16OYRORD", "GRASSH16OYRO082", "U16CACTUSRANBS", "U165MARTINPRO", "U145SCA2438", "STSTR400155", "230115006708976", "SP2241-940V-05", "C165MIKESCUS14BK", "U135CROWNCRO9", "U14TSLONESIGTR", "C14OLIVERROSR", "C145DMARTINTR14", "U125TESKEYSRAN12", "232816507008975", "KS9310-14-10", "236415506508989", "U15NRSPROTR14BSK", "232816007008974", "SCA155CSR2756", "SCA14CSR2752", "SCA145C2760", "SCA155CSR2758", "RK1112-7-12", "RK1110-7-10", "C15NRSPROCR14BK", "U15RUNPTROGC", "U14COWPUNRR14SF", "HR15RANASBUCK", "U145CACTUSTR2520", "C15DELRANROPEBD", "U15MARTIN58CB", "U14STSBR14SPDR", "C15BMARRSRO1123", "C155SSREAINER", "U16LWILLIAMSRRO", "C135NOMRANRO", "C155HKINGRRSM", "U155GRASSHRO49", "C17JLCUSTRC78CB", "GRASSH155SWWJ083", "U165CARLHUTTONCU", "SCA165C387", "U155MIKESRR12CB", "U155HERETR78FL", "230114506708670", "U145BRCHOC78CB", "230114506508458", "230114006708635", "C13BCOOKBR12SP", "SCA16AR2118SR14", "SCA16AR2117SRBS", "HR16CH12CHOCHFL", "KS9314-14-14", "KS9315-14-15", "KS9316-14-16", "SR1042-89-12", "SR1040-89-10", "C14JJBROAKSIL", "U145JSRANCUT12A", "C13CHBRJRCAAA04", "C13CHBRJRCAAAC7", "C125CHBRJRCAAAC", "U13STSGORDIE12U", "SCA16CSR2164", "SCA145CSR2213", "230114006508461", "230114506508459", "230115006508465", "C155NOMAKETRAIN", "U14CORBRCHSTR", "U14MARTINBRCC12", "230114006508462", "239713007009163", "U15BHTRRWB", "230114006508460", "C14SMARTH78HD", "U145COATSTREL11", "U145MASTERTRFTFL", "1255-040C-05", "237514006708972", "237114007009256", "U14SP4233BSK34", "U155TADSRCSTBD", "C145NMCRFTFL", "C145MADDOX78FT", "230114006508463", "232816507008235", "230114506508456", "237514506708970", "SCA14TR2116RO", "HR155RANAS12BSK", "230114506508455", "230115006508453", "236714507008957", "U135BURNSTR12SP", "C14JJBRCHSRP93", "U14RMOTEBARH12BK", "SCATR15ROBS", "234614507008240", "234614506509857", "C135CYTREELESS", "C14HEREFORDFTFL", "C15CALLENCUT14BK", "C145BMARRSRANRO", "SRS145BR12CBCHO8", "SRS14BR12CBPR7", "CH10TR12BSK20", "CH13RANROSDSR14", "CH13RAN12SPSR15", "CH13RANROPR24", "CH13RANROSD27", "CH13RANROBSRS33", "CH13RANROBSSS31", "CH13RANROSDSR13", "CH125RA12BSKSR18", "CH125RANROPR25", "CH12RANROPR23", "CH12RAN12DWSR16", "CH12RANROSD29", "CH12RANROBSRS32", "CH12RANROSDSR11", "CH115RAN12SFSR17", "CH115RANROPR22", "CH115RANROSD28", "CH10RAN12GEO35", "SR9025-60-15", "KS9312-14-12", "C145RUNPKSPRA99", "C145AMMERTR1989", "C145AMMERTR1993", "C145AMMERTR1992", "230816506708248", "232716506508951", "C14SMARTHTR78F", "233613506708277", "234615007008243", "234614007009241", "U16BOBCOOPERRAN", "U16BOBTRFTFL083", "U165JANDSCUT78", "U155CACTUSCHOCTR", "C16BWARDRR14FL", "U15JPETRIRAN14FL", "C15TBARCTRFTCB", "C16SHARPERSHOWFT", "C145MARTINBRTRO", "C13ERTRAILSYLEA", "U16VINTONSHOWFT", "KS9314-7-14", "239713007009265", "C155RONCRANFLBD", "TWS17RC58FL", "U15CCTRFTSRBOY", "C15MARTINTR78", "RK3110-32-10", "RK3112-32-12", "RK1114-7-14", "RK1116-7-16", "KS9316-7-16", "MJ03-255T-05", "U15TWISTER2001TR", "U145CLEBURNE12BK", "SR4612-91-12", "SR4610-91-10", "SCA155WC571242", "U14BCOOKSHOWFTF", "C14NRSPROCR14BK", "U145KDNELSONTR", "C14TWISTTR2003", "SR7776-91-16", "SCA14C876RO", "C155LHBCSHOWFTFL", "C15CACTUSTR12F", "C13EDPHILRAN", "KS9310-2-14", "KS9310-2-13", "KS9310-2-12", "KS9310-2-10", "RK240-89-10", "U15DJRRHIMONEY", "KS9214-2-14", "STSCU10016", "2614-060T-05", "KS2630-32-10", "U15RANNOMAKERO", "NASH173TRL17", "NASH173TRL16", "NASH231TRL16", "NASH935BR14", "U145LAZYL12SP", "SR1712-80-12", "SR7773-91-13", "SR7770-91-10", "U155NOMAKETRFTFL", "243346", "6808-1601-05", "6808-1701-05", "2613-1701-05", "U16MCINTYREROP14", "NASH14BR138", "NASH14BR136", "NASH14BR157", "NASH15BR148", "224614006507317", "SCA135CSR574005", "C12BROWNFTFL", "KS2633-32-13", "229713507007295", "CH125RANBSKBW", "CH12RANBSBDSCAL", "SR5022-33-12", "JJ135SBPF150", "C135CCSBR2010", "C145HEREFORD75", "JJ135SBP885", "JJ135SBP901WIDE", "STSRA100145", "C15TWSTRFTFL", "U165HOGGCR78FL", "KS9210-2-10", "STS15CORTEZSMFLX", "STSAA10014", "NASH150BR15", "NASH231TRAIL17", "HR15SSBR12FLTQ", "SCABR135FLX3052", "SCABR145CHO3053", "USHER135BR12FL", "RK212-32-12", "HR16SSRANCHS", "U16MASTERTRFTFL", "U15KINGSHOWFTFL", "U145BHORNBRMX", "U15CCTRAIL", "SR7775-2-15", "SR7774-2-14", "C165DUNNINGCUT", "C14LHORNTRFTFL", "U155PANTHERCBR", "STSRC700155", "STSRC70016", "STSJRR13012MBBW", "STSRC30016CHRO", "C14CASEYTEWBR", "C145TESKEYBRCLEM", "SR7775-91-15", "SR7774-91-14", "STS16GOLDENSOCHO", "SR1610-91-10", "SR7850-93-10", "C14NOMROPER78FL", "COOL16RANROSYN", "COOL145RANROSYN", "C15NOMAKSPBD", "C155AUSTRALIAN", "C145MARKL558985", "C145MARKL558987", "STSRN40016", "HR13TRCHOC12FL", "SR7970-93-10", "STSBR800145", "STS16LARKSPURRSO", "SR7963-93-13", "SR7962-93-12", "SR7960-93-10", "STSRC300155CHRO", "STSBR400145RO", "SRK8", "SR7953-93-13", "STSAA10013512BSK", "STSBR100145TURBS", "STSRN10016", "SR7950-93-10", "SR7952-93-12", "COOL15RANROSYN", "STSJRR12012MBBW", "U165SRSCUT12BK", "U16HRRANCUTROO", "U14BURNSBRRO", "U15HRTRRO14CH", "SCA145C2759ROSR", "U135JJPPRO70551", "C135SHILOHSH8922", "SR1066-83-16", "U145LCLARKRRRO", "C16CORRISHOWFTFL", "HR155SSRANCHS"];


if (jQuery("#js-PROD").length > 0) {
    var strProductCode = jQuery('#js-PROD .product-information .product-information--purchase .column.whole .product-code').text();
    if(strProductCode != "" && strProductCode !== undefined){
        strProductCode = strProductCode.replace('Code: ', '');
    }

    if(jQuery.inArray(strProductCode, arrApprovedProductCode) !== -1){
        addPopupUpsellOnSaddleATC();
    }
}

function addPopupUpsellOnSaddleATC() {
    var intCount = 0;
    var intInterval = setInterval(function() {
        intCount += 1;
        
        if (jQuery("#js-PROD .add-to-cart-wrap #js-add-to-cart").length > 0 && jQuery("#custOxbowProductPopup").length == 0) {
            //append popup to the body
            jQuery('<div class="custPopupOuter" id="custOxbowProductPopup"><div class="custPopupBox"><div class="custTopBar"><img src="https://growth-hit.s3.us-west-2.amazonaws.com/Coolhorse/vector.png" alt="vector"><h5>The item has been added to cart. Thank you!</h5><button class="custClosePopup"><img src="https://growth-hit.s3.us-west-2.amazonaws.com/Coolhorse/close.png" alt="close"></button></div><hr class="custBorder"><div class="custContent"><div class="custLeftBox"><h3>One-Time Exclusive Offer</h3><div class="custImgDesk"><img src="https://growth-hit.s3.us-west-2.amazonaws.com/Coolhorse/oxbow-tack.png" alt="vector"></div><h5>Oxbow Tack 34"X36" Contoured Blanket Top Fleece Show Pad</h5><ul class="custPriceList"><li><span class="custSave">SAVE 40%</span></li><li><span class="custPriceOff">$195.00</span><span class="custPrice">$110.00</span></li></ul><ul class="custDetailsProduct"><li>100% Wool Blanket Top</li><li>Provide max comfort for your horseâ€™s back</li><li>Orthopedic-grade felt center absorbs shock</li></ul><div class="custSelectWrap"><select name="custColorSelect" id="custColorSelect"><option value="" selected="selected" disabled="disabled">Select color</option><option value="601160-TN/BR">1: Tan/Brown</option><option value="601160-GY/BK">3: Black/Grey</option><option value="601160-TN/BK">4: Chocolate/Tan</option></select><button id="custAddTocart" disabled="disabled">Add to Cart</button></div></div><div class="custRightBox"><div class="custImg"><img src="https://growth-hit.s3.us-west-2.amazonaws.com/Coolhorse/oxbow-tack.png" alt="vector"></div></div></div></div></div>').prependTo('body');
        }
        if (intCount === 200) {
            clearInterval(intInterval);
        }
    }, 50);
}

//show popup on the click of Add to cart button
jQuery('#js-purchase-product .add-to-cart-wrap #js-add-to-cart').on('click', function() {
    setTimeout(function(){
        jQuery('#custOxbowProductPopup').css('display', 'flex');
    }, 750);
});


//close popup on the click of close 
jQuery(document).on('click', '.custClosePopup', function() {
    jQuery('#custOxbowProductPopup').css('display', 'none');
});

//after change color event
jQuery(document).on('change', '#custColorSelect', function() {
    // only on change of color Add to cart button should be enabled
    var strColorCode = jQuery('#custColorSelect').val();
    if (strColorCode !== '' && strColorCode !== undefined && strColorCode !== null) {
        jQuery('#custAddTocart').prop('disabled', false);
    } else {
        jQuery('#custAddTocart').prop('disabled', true);
    }
});

//add to cart click event for product add into the cart
jQuery(document).on('click', '#custAddTocart', function() {
    var strColorCode = jQuery('#custColorSelect').val();
    
    if (strColorCode !== '' && strColorCode !== undefined && strColorCode !== null) {
        
        jQuery.ajax({
            type: "POST",
            url: "https://shop.coolhorse.com/store/BASK",
            data: {
                'Product_Code': '601160',
                'Action': 'ADPR',
                'Quantity': 1,
                'Product_Attributes[1]:code': 'Color',
                'Product_Attributes[1]:value': strColorCode
            },
            headers: {
                'contentType': 'application/json'
            },
            success: function(data) {

                if (jQuery('#custOxbowProductPopup').length > 0) {
                    jQuery('#custOxbowProductPopup').hide();
                }

                if (data !== '' && data !== undefined && data !== null) {
                    var strSelector = '';
                    var strCartHTML = jQuery(data).find('#js-mini-basket-container').html();

                    if (jQuery(window).width() < 767) {
                        strSelector = '.mobile-basket-button #js-mini-basket-count';
                    } else {
                        strSelector = '.mini-basket #js-mini-basket-count';
                    }

                    var intCartCount = jQuery(data).find(strSelector).text();
                    if (strCartHTML !== '' && strCartHTML !== undefined && strCartHTML !== null) {
                            jQuery('#js-mini-basket-container').html(strCartHTML);
                            jQuery(strSelector).text(intCartCount);

                            if (jQuery('#js-main-header #js-mini-basket').length > 0) {
                                jQuery('#js-main-header #js-mini-basket')[0].click();
                                setTimeout(function() {
                                    jQuery('#js-main-header #js-mini-basket')[0].click();
                                }, 5000);
                            }
                    }
                    
                }
            }
        });
    }
});